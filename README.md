# Da Big Mek Workshop üü¢‚öôÔ∏èüí•

> **WAAAGH!** –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è Domain-Driven Design –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ –æ—Ä–æ—á—å–µ–π –º–∞—Å—Ç–µ—Ä—Å–∫–æ–π –∏–∑ –≤—Å–µ–ª–µ–Ω–Ω–æ–π Warhammer 40,000

## üéØ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç

**Da Big Mek Workshop** ‚Äî —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ä–æ—á—å–µ–π –º–∞—Å—Ç–µ—Ä—Å–∫–æ–π, –≥–¥–µ –ë–æ–ª—å—à–æ–π –ú–µ–∫ —Å–æ–∑–¥–∞—ë—Ç –æ—Ä—É–∂–∏–µ –∏ –±–æ–µ–≤—ã–µ –º–∞—à–∏–Ω—ã –∏–∑ –Ω–∞–≥—Ä–∞–±–ª–µ–Ω–Ω–æ–≥–æ —Ö–ª–∞–º–∞.

–û—Ä–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç —Å—Ç—Ä–µ–ª—è–ª—ã (shootas), —Ç—è–∂—ë–ª–æ–µ –≤–æ–æ—Ä—É–∂–µ–Ω–∏–µ, –≥—Ä—É–∑–æ–≤–∏–∫–∏ –∏ –±–æ–µ–≤—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –∏–∑ —á–µ–≥–æ –ø–æ–ø–∞–ª–æ: –∏–º–ø–µ—Ä—Å–∫–æ–π —Ç–µ—Ö–Ω–∏–∫–∏, —ç–ª—å–¥–∞—Ä—Å–∫–∏—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤, —Ä–∂–∞–≤–æ–≥–æ –∂–µ–ª–µ–∑–∞. –ü—Ä–∏ —ç—Ç–æ–º –¥–µ–π—Å—Ç–≤—É—é—Ç –∞–±—Å—É—Ä–¥–Ω—ã–µ, –Ω–æ —Å—Ç—Ä–æ–≥–∏–µ –∑–∞–∫–æ–Ω—ã –æ—Ä–æ—á—å–µ–π —Ñ–∏–∑–∏–∫–∏:
- **–ö—Ä–∞—Å–Ω–æ–µ –±—ã—Å—Ç—Ä–µ–µ** ‚Üí –∫—Ä–∞—Å–Ω—ã–µ –≤–µ—â–∏ –ø–æ–ª—É—á–∞—é—Ç –±–æ–Ω—É—Å –∫ —Å–∫–æ—Ä–æ—Å—Ç–∏
- **–ë–æ–ª—å—à–µ –¥–∞–∫–∫–∏ = –ª—É—á—à–µ** ‚Üí —á–µ–º –±–æ–ª—å—à–µ –æ–≥–Ω–µ–≤–æ–π –º–æ—â–∏, —Ç–µ–º –ª—É—á—à–µ
- **–ï—Å–ª–∏ –æ—Ä–∫–∏ –≤–µ—Ä—è—Ç, —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç** ‚Üí WAAAGH —ç–Ω–µ—Ä–≥–∏—è –¥–µ–ª–∞–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ–µ –≤–æ–∑–º–æ–∂–Ω—ã–º
- **–ù–µ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ –≤–∑—Ä—ã–≤–∞—é—Ç—Å—è** ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ö–ª–∞–º–∞ –ø–æ–≤—ã—à–∞–µ—Ç —à–∞–Ω—Å –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–∫–∞–∑–∞

## üîß –ö–∞–∫–∏–µ –∑–∞–¥–∞—á–∏ —Ä–µ—à–∞–µ—Ç

### –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏

1. **–ü–æ–∫–∞–∑–∞—Ç—å —ç–≤–æ–ª—é—Ü–∏—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã** –æ—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ CRUD –∫ Domain-Driven Design
2. **–ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏** –∞–Ω–µ–º–∏—á–Ω–æ–π –º–æ–¥–µ–ª–∏ –∏ "—Ç–æ–ª—Å—Ç—ã—Ö" —Å–µ—Ä–≤–∏—Å–æ–≤
3. **–û–±—É—á–∏—Ç—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–º—É –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é** DDD –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–π
4. **–û–±—ä—è—Å–Ω–∏—Ç—å –∫–æ–≥–¥–∞ –∏ –ø–æ—á–µ–º—É** –Ω—É–∂–µ–Ω –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ DDD

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏

–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª—è–µ—Ç:
- **–ò–Ω–≤–µ–Ω—Ç–∞—Ä—ë–º –º–∞—Å—Ç–µ—Ä—Å–∫–æ–π** ‚Äî –Ω–∞–≥—Ä–∞–±–ª–µ–Ω–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ —Ä–∞–∑–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –∏ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è
- **–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ä—É–∂–∏—è** ‚Äî —Å–±–æ—Ä–∫–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –¥–µ—Ç–∞–ª–µ–π –∏ –Ω–∞–≤—ã–∫–æ–≤ –º–µ–∫–∞
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–¥–µ–ª–∏–π** ‚Äî —Å—Ç—Ä–µ–ª—å–±–∞ —Å —É—á—ë—Ç–æ–º –∫–∞—á–µ—Å—Ç–≤–∞, WAAAGH —ç–Ω–µ—Ä–≥–∏–∏ –∏ —Å–ª—É—á–∞–π–Ω—ã—Ö –æ—Ç–∫–∞–∑–æ–≤
- **–ü–æ—Å—Ç—Ä–æ–π–∫–æ–π —Ç–µ—Ö–Ω–∏–∫–∏** ‚Äî –º–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã —Å–±–æ—Ä–∫–∏ —Å–ª–æ–∂–Ω—ã—Ö –º–∞—à–∏–Ω
- **–†–µ–ø—É—Ç–∞—Ü–∏–µ–π –º–µ–∫–∞** ‚Äî –≤–ª–∏—è–Ω–∏–µ –Ω–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–≥–æ –æ—Ä—É–∂–∏—è
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π** ‚Äî —É—Å–ø–µ—à–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è, –≤–∑—Ä—ã–≤—ã, —Ä–µ–π—Ç–∏–Ω–≥–∏ –æ—Ä—É–∂–∏—è

## üìö –ß–µ–º—É –Ω–∞—É—á–∏—Ç –ø—Ä–æ–µ–∫—Ç

### –ö–æ–Ω—Ü–µ–ø—Ü–∏–∏ DDD

- **Ubiquitous Language** ‚Äî –µ–¥–∏–Ω—ã–π —è–∑—ã–∫ –±–∏–∑–Ω–µ—Å–∞ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (dakka, WAAAGH, shoota, mek)
- **Entities vs Value Objects** ‚Äî –∫–æ–≥–¥–∞ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–∞, –∞ –∫–æ–≥–¥–∞ –Ω–µ—Ç
- **Aggregates** ‚Äî –∫–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å –±–∏–∑–Ω–µ—Å-–∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é
- **Domain Events** ‚Äî –∫–∞–∫ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
- **Specifications** ‚Äî –∫–∞–∫ –≤—ã—Ä–∞–∑–∏—Ç—å —Å–ª–æ–∂–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –≤ –∫–æ–¥–µ
- **Domain Services** ‚Äî –∫–æ–≥–¥–∞ –ª–æ–≥–∏–∫–∞ –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –æ–¥–Ω–æ–º—É aggregate
- **Bounded Contexts** ‚Äî –∫–∞–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –±–æ–ª—å—à—É—é —Å–∏—Å—Ç–µ–º—É –Ω–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —á–∞—Å—Ç–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

- **Rich Domain Model** vs Anemic Domain Model
- **CQRS** (Command Query Responsibility Segregation)
- **Event Sourcing** ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–∑ —Å–æ–±—ã—Ç–∏–π
- **Saga Pattern** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
- **Repository Pattern** ‚Äî –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
- **Anti-Corruption Layer** ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏

- –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –æ—Ç –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω–æ–≥–æ –∫ –æ–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –∫–æ–¥—É
- –í—ã–¥–µ–ª–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –∏–∑ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö —Å–ª–æ—ë–≤
- –ù–∞–ø–∏—Å–∞–Ω–∏–µ –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –Ω–∞ domain –ª–æ–≥–∏–∫—É
- –†–∞–±–æ—Ç–∞ —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –∏ eventual consistency
- –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –º–µ–∂–¥—É bounded contexts

---

## üöÄ –ü–ª–∞–Ω —ç–≤–æ–ª—é—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞

### Stage 0: Anemic Model ‚Äî "–ü–æ—á—É–≤—Å—Ç–≤—É–π –±–æ–ª—å"

**–¶–µ–ª—å:** –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ —Å —Å–µ—Ä–≤–∏—Å–Ω—ã–º —Å–ª–æ–µ–º

#### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è (–ø—Ä–æ—Å—Ç—ã–µ):

1. **–°–æ–∑–¥–∞—Ç—å –º–∞—Å—Ç–µ—Ä—Å–∫—É—é** —Å –∏–º–µ–Ω–µ–º –º–µ–∫–∞
2. **–î–æ–±–∞–≤–∏—Ç—å –ª—É—Ç** –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å (–Ω–∞–∑–≤–∞–Ω–∏–µ, —Ç–∏–ø, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)
3. **–°–æ–±—Ä–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–µ —Å—Ç—Ä–µ–ª—è–ª–æ** –∏–∑ –∏–º–µ—é—â–∏—Ö—Å—è –¥–µ—Ç–∞–ª–µ–π
4. **–í—ã—Å—Ç—Ä–µ–ª–∏—Ç—å** –∏–∑ —Å—Ç—Ä–µ–ª—è–ª–∞ –∏ —É–∑–Ω–∞—Ç—å –ø–æ–ø–∞–ª –∏–ª–∏ –Ω–µ—Ç

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

```
views.py ‚Üí services.py ‚Üí models.py (Django ORM)
```

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:

```python
# models.py - Anemic Domain Model
class Workshop(models.Model):
    mek_name = models.CharField(max_length=100)
    reputation = models.IntegerField(default=0)

class Scrap(models.Model):
    workshop = models.ForeignKey(Workshop)
    name = models.CharField(max_length=100)
    scrap_type = models.CharField(max_length=50)
    quantity = models.IntegerField()

class Weapon(models.Model):
    workshop = models.ForeignKey(Workshop)
    name = models.CharField(max_length=100)
    dakka = models.IntegerField()
    parts = models.JSONField()

# services.py - Fat Services
class WeaponService:
    def build_weapon(self, workshop_id, weapon_data):
        workshop = Workshop.objects.get(id=workshop_id)
        parts = Scrap.objects.filter(workshop=workshop)
        
        # –í—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∑–¥–µ—Å—å
        if parts.count() < 3:
            raise ValidationError("Not enough parts")
        
        dakka = 0
        for part in parts[:3]:
            dakka += 5
            part.quantity -= 1
            part.save()
        
        weapon = Weapon.objects.create(
            workshop=workshop,
            name=weapon_data['name'],
            dakka=dakka,
            parts=[p.id for p in parts[:3]]
        )
        
        workshop.reputation += 1
        workshop.save()
        
        return weapon
    
    def fire_weapon(self, weapon_id):
        weapon = Weapon.objects.get(id=weapon_id)
        
        # –õ–æ–≥–∏–∫–∞ —Å—Ç—Ä–µ–ª—å–±—ã –≤ —Å–µ—Ä–≤–∏—Å–µ
        hit_chance = weapon.dakka / 100
        if random.random() < hit_chance:
            return {"result": "HIT"}
        return {"result": "MISS"}
```

#### –ü—Ä–æ–±–ª–µ–º—ã –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—è–≤—è—Ç—Å—è:

‚ùå **–õ–æ–≥–∏–∫–∞ —Ä–∞–∑–º–∞–∑–∞–Ω–∞** ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ views, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤ services, –¥–∞–Ω–Ω—ã–µ –≤ models  
‚ùå **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ "–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –¥–µ—Ç–∞–ª–µ–π" –±—É–¥–µ—Ç –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö  
‚ùå **–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –±–µ–∑ –ë–î  
‚ùå **–ù–∞—Ä—É—à–µ–Ω–∏–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤** ‚Äî –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å weapon —Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º dakka  
‚ùå **–ù–µ—è—Å–Ω–∞—è —Å–µ–º–∞–Ω—Ç–∏–∫–∞** ‚Äî —á—Ç–æ –∑–Ω–∞—á–∏—Ç `parts = models.JSONField()`?  
‚ùå **–°–ª–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ "–∫—Ä–∞—Å–Ω–æ–π –∫—Ä–∞—Å–∫–∏" –ø–æ—Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ 5 –º–µ—Å—Ç–∞—Ö

---

### Stage 1: Tactical DDD ‚Äî "Rich Domain Model"

**–¶–µ–ª—å:** –í—ã–Ω–µ—Å—Ç–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ domain —Å–ª–æ–π, –≤–≤–µ—Å—Ç–∏ Value Objects –∏ Entities

#### –ù–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:

5. **–ö–∞—á–µ—Å—Ç–≤–æ –¥–µ—Ç–∞–ª–µ–π** –≤–ª–∏—è–µ—Ç –Ω–∞ —à–∞–Ω—Å –≤–∑—Ä—ã–≤–∞ (SHINY, NORMAL, RUSTY, EXPLODY)
6. **–ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –ª—É—Ç–∞** –≤–ª–∏—è–µ—Ç –Ω–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (IMPERIAL, ELDAR, ORK, JUNK)
7. **–ü–æ–∫—Ä–∞—Å–∏—Ç—å –æ—Ä—É–∂–∏–µ –≤ –∫—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç** –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –¥–∞–∫–∫–∏ (+5 bonus)
8. **–£—á–∏—Ç—ã–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Ä—É–∂–∏—è** (NEW, USED, DAMAGED, EXPLODED)
9. **–ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –¥–µ—Ç–∞–ª–µ–π** (–∏–º–ø–µ—Ä—Å–∫–æ–µ + —ç–ª—å–¥–∞—Ä—Å–∫–æ–µ = –≤–∑—Ä—ã–≤)

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           Presentation Layer                ‚îÇ
‚îÇ         (views.py, serializers.py)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          Application Layer                  ‚îÇ
‚îÇ    (command handlers, query handlers)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ            Domain Layer                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ Entities: Weapon, Mek                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ Value Objects: Scrap, DakkaRating    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ Aggregates: MekWorkshop              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ Domain Events: WeaponBuiltEvent      ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        Infrastructure Layer                 ‚îÇ
‚îÇ    (ORM models, repositories, DB)           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

**Value Objects** (–∏–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã–µ, –±–µ–∑ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏):

```python
@dataclass(frozen=True)
class Scrap:
    source: ScrapSource      # Enum: IMPERIAL, ELDAR, ORK, JUNK
    scrap_type: ScrapType    # Enum: ENGINE, ARMOR, SHOOTY_BITZ...
    quality: Quality         # Enum: SHINY, NORMAL, RUSTY, EXPLODY
    quantity: int
    
    def is_compatible_with(self, other: 'Scrap') -> bool:
        """–ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–æ: –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–µ—Ç–∞–ª–∏ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã"""
        if self.source == ScrapSource.IMPERIAL and other.source == ScrapSource.ELDAR:
            return False  # –ò–º–ø–µ—Ä—Å–∫–∞—è –∏ —ç–ª—å–¥–∞—Ä—Å–∫–∞—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è –Ω–µ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã
        return True
    
    def __post_init__(self):
        if self.quantity <= 0:
            raise ValueError("Quantity must be positive")

@dataclass(frozen=True)
class DakkaRating:
    base_dakka: int
    bonus_dakka: int
    
    @property
    def total(self) -> int:
        return self.base_dakka + self.bonus_dakka
    
    def with_bonus(self, bonus: int) -> 'DakkaRating':
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –±–æ–Ω—É—Å–æ–º"""
        return DakkaRating(
            base_dakka=self.base_dakka,
            bonus_dakka=self.bonus_dakka + bonus
        )
```

**Entity** (—Å –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å—é):

```python
class Weapon(Entity):
    def __init__(
        self,
        weapon_id: WeaponId,
        name: str,
        parts: List[Scrap],
        dakka: DakkaRating,
        color: Color = Color.UNPAINTED
    ):
        self._id = weapon_id
        self._name = name
        self._parts = parts
        self._dakka = dakka
        self._color = color
        self._condition = Condition.NEW
        self._malfunctions = 0
        self._events: List[DomainEvent] = []
    
    def paint_red(self) -> None:
        """–ü–æ–∫—Ä–∞—Å–∏—Ç—å –≤ –∫—Ä–∞—Å–Ω—ã–π - —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –¥–∞–∫–∫—É"""
        if self._color == Color.RED:
            raise AlreadyRedError("ITZ ALREADY RED YA GIT!")
        
        self._color = Color.RED
        self._dakka = self._dakka.with_bonus(5)  # –ò–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
        
        self._add_event(WeaponPaintedRedEvent(
            weapon_id=self._id,
            new_dakka=self._dakka.total
        ))
    
    def fire(self, ork_count: int) -> FiringResult:
        """–í—ã—Å—Ç—Ä–µ–ª —Å —É—á—ë—Ç–æ–º –≤–µ—Ä—ã –æ—Ä–∫–æ–≤ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—Ä—É–∂–∏—è"""
        self._ensure_can_fire()
        
        # WAAAGH —ç–Ω–µ—Ä–≥–∏—è: —á–µ–º –±–æ–ª—å—à–µ –æ—Ä–∫–æ–≤ –≤–µ—Ä—è—Ç, —Ç–µ–º –ª—É—á—à–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
        belief_modifier = min(ork_count // 10, 10)
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤–∑—Ä—ã–≤
        if self._check_explosion():
            self._condition = Condition.EXPLODED
            self._add_event(WeaponExplodedEvent(self._id))
            return FiringResult.EXPLODED
        
        # –†–∞—Å—á—ë—Ç –ø–æ–ø–∞–¥–∞–Ω–∏—è
        effective_dakka = self._dakka.total + belief_modifier
        hit_chance = min(effective_dakka / 100, 0.95)
        
        if random.random() < hit_chance:
            self._malfunctions = 0
            self._add_event(WeaponFiredSuccessfullyEvent(self._id))
            return FiringResult.HIT
        else:
            self._malfunctions += 1
            self._condition = Condition.USED
            return FiringResult.MISS
    
    def _ensure_can_fire(self) -> None:
        """–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç: –Ω–µ–ª—å–∑—è —Å—Ç—Ä–µ–ª—è—Ç—å –∏–∑ –≤–∑–æ—Ä–≤–∞–Ω–Ω–æ–≥–æ –æ—Ä—É–∂–∏—è"""
        if self._condition == Condition.EXPLODED:
            raise CannotFireExplodedWeaponError()
    
    def _check_explosion(self) -> bool:
        """–®–∞–Ω—Å –≤–∑—Ä—ã–≤–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–∞—á–µ—Å—Ç–≤–∞ –¥–µ—Ç–∞–ª–µ–π"""
        base_chance = 0.05
        
        for part in self._parts:
            if part.quality == Quality.EXPLODY:
                base_chance += 0.2
            elif part.quality == Quality.RUSTY:
                base_chance += 0.1
        
        base_chance += self._malfunctions * 0.05
        
        return random.random() < base_chance
```

**Aggregate Root** (–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å):

```python
class MekWorkshop(AggregateRoot):
    """–ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è - –∫–æ—Ä–µ–Ω—å –∞–≥—Ä–µ–≥–∞—Ç–∞"""
    
    def __init__(self, workshop_id: WorkshopId, mek_name: str):
        self._id = workshop_id
        self._mek_name = mek_name
        self._inventory: List[Scrap] = []
        self._weapons: Dict[WeaponId, Weapon] = {}
        self._reputation = 0
    
    def loot_scrap(self, scrap: Scrap) -> None:
        """–î–æ–±–∞–≤–∏—Ç—å –ª—É—Ç - –≤—Å–µ–≥–¥–∞ –≤–∞–ª–∏–¥–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è"""
        self._inventory.append(scrap)
        self._add_event(ScrapLootedEvent(self._id, scrap))
    
    def build_shoota(self, parts_needed: List[ScrapType]) -> Weapon:
        """–°–æ–±—Ä–∞—Ç—å —Å—Ç—Ä–µ–ª—è–ª–æ - –∑–∞—â–∏—Ç–∞ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤"""
        
        # –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç 1: –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ—Ç–∞–ª–µ–π
        available = self._find_parts(parts_needed)
        if len(available) < len(parts_needed):
            raise NotEnuffBitsError(
                f"Need {len(parts_needed)} parts, have {len(available)}"
            )
        
        # –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç 2: –¥–µ—Ç–∞–ª–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã
        for i, part1 in enumerate(available):
            for part2 in available[i+1:]:
                if not part1.is_compatible_with(part2):
                    raise IncompatiblePartsError(
                        f"{part1.source} and {part2.source} don't work together!"
                    )
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ä—É–∂–∏—è
        dakka = self._calculate_dakka(available)
        weapon = Weapon(
            weapon_id=WeaponId.generate(),
            name="Shoota",
            parts=available,
            dakka=dakka
        )
        
        # –£–¥–∞–ª–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –¥–µ—Ç–∞–ª–µ–π
        for part in available:
            self._inventory.remove(part)
        
        self._weapons[weapon.id] = weapon
        self._reputation += 1
        
        self._add_event(WeaponBuiltEvent(self._id, weapon.id))
        
        return weapon
    
    def _calculate_dakka(self, parts: List[Scrap]) -> DakkaRating:
        """–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ –æ–≥–Ω–µ–≤–æ–π –º–æ—â–∏"""
        base = 10
        bonus = 0
        
        for part in parts:
            if part.quality == Quality.SHINY:
                bonus += 2
            elif part.source == ScrapSource.IMPERIAL:
                bonus += 3  # –ò–º–ø–µ—Ä—Å–∫–æ–µ –Ω–∞–¥—ë–∂–Ω–µ–µ
        
        return DakkaRating(base_dakka=base, bonus_dakka=bonus)
```

#### –ß—Ç–æ –º—ã –ø–æ–ª—É—á–∏–ª–∏:

‚úÖ **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ** ‚Äî –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ domain —Å–ª–æ–µ  
‚úÖ **–ó–∞—â–∏—â—ë–Ω–Ω—ã–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã** ‚Äî –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ  
‚úÖ **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** ‚Äî domain –ª–æ–≥–∏–∫–∞ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ë–î  
‚úÖ **–í—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** ‚Äî –∫–æ–¥ —á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ –±–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è  
‚úÖ **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** ‚Äî –Ω–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ

---

### Stage 2: Specifications & Domain Services

**–¶–µ–ª—å:** –í–≤–µ—Å—Ç–∏ —Å–ª–æ–∂–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –∏ –ª–æ–≥–∏–∫—É, –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—â—É—é –Ω–µ—Å–∫–æ–ª—å–∫–æ aggregates

#### –ù–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:

10. **–ù–∞–≤—ã–∫–∏ –º–µ–∫–∞** –≤–ª–∏—è—é—Ç –Ω–∞ —á—Ç–æ –æ–Ω –º–æ–∂–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å (—É—Ä–æ–≤–Ω–∏: GROT, NORMAL, BIG_MEK)
11. **–°–ª–æ–∂–Ω—ã–µ blueprints** –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—Ä—É–∂–∏—è (shoota, big shoota, mega blasta)
12. **–ü—Ä–æ–≤–µ—Ä–∫–∞ "can build"** —Å —É—á—ë—Ç–æ–º –Ω–∞–≤—ã–∫–æ–≤, –¥–µ—Ç–∞–ª–µ–π –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
13. **WAAAGH —ç–Ω–µ—Ä–≥–∏—è** –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Ä–∞–Ω–≥–∞ –æ—Ä–∫–æ–≤ –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏
14. **–†–µ–ø—É—Ç–∞—Ü–∏—è –º–µ–∫–∞** –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–≥–æ –æ—Ä—É–∂–∏—è

#### –ù–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:

**Specification Pattern:**

```python
class CanBuildWeaponSpec(Specification[MekWorkshop]):
    """–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è: –º–æ–∂–Ω–æ –ª–∏ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –æ—Ä—É–∂–∏–µ"""
    
    def __init__(self, blueprint: WeaponBlueprint, mek_skill: MekSkill):
        self._blueprint = blueprint
        self._mek_skill = mek_skill
    
    def is_satisfied_by(self, workshop: MekWorkshop) -> bool:
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–≤—ã–∫–æ–≤
        if blueprint.complexity > self._mek_skill.level:
            return False
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–µ—Ç–∞–ª–µ–π
        required = self._blueprint.required_parts
        if not workshop.has_parts(required):
            return False
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        parts = workshop.get_parts(required)
        compatibility_spec = PartsCompatibilitySpec(parts)
        if not compatibility_spec.is_satisfied_by(workshop):
            return False
        
        return True
    
    def why_not_satisfied(self, workshop: MekWorkshop) -> str:
        """–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ—á–µ–º—É –Ω–µ–ª—å–∑—è"""
        if self._blueprint.complexity > self._mek_skill.level:
            return f"Mek skill {self._mek_skill} too low for {self._blueprint.name}"
        
        if not workshop.has_parts(self._blueprint.required_parts):
            return "Not enough parts in inventory"
        
        return "Parts are incompatible"

class RedVehicleGoFasterSpec(Specification[Vehicle]):
    """–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è: –∫—Ä–∞—Å–Ω—ã–µ –º–∞—à–∏–Ω—ã –µ–¥—É—Ç –±—ã—Å—Ç—Ä–µ–µ"""
    
    def is_satisfied_by(self, vehicle: Vehicle) -> bool:
        return vehicle.color == Color.RED
    
    def apply_bonus(self, vehicle: Vehicle) -> int:
        """–í–µ—Ä–Ω—É—Ç—å –±–æ–Ω—É—Å –∫ —Å–∫–æ—Ä–æ—Å—Ç–∏"""
        if self.is_satisfied_by(vehicle):
            return 20  # +20% —Å–∫–æ—Ä–æ—Å—Ç–∏
        return 0
```

**Domain Service:**

```python
class WaaghEnergyService:
    """Domain Service: –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ WAAAGH —ç–Ω–µ—Ä–≥–∏–∏
    
    –õ–æ–≥–∏–∫–∞ –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –Ω–∏ Workshop, –Ω–∏ Weapon, –Ω–∏ Ork
    ‚Üí –≤—ã–Ω–æ—Å–∏–º –≤ Domain Service
    """
    
    def calculate_belief_power(
        self,
        workshop: MekWorkshop,
        weapon: Weapon,
        nearby_orks: List[Ork]
    ) -> int:
        """–ß–µ–º –±–æ–ª—å—à–µ –æ—Ä–∫–æ–≤ –≤–µ—Ä—è—Ç, —Ç–µ–º –ª—É—á—à–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"""
        
        # –ë–∞–∑–æ–≤–∞—è –≤–µ—Ä–∞ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—Ä–∫–æ–≤
        base = len(nearby_orks)
        
        # –ë–æ–Ω—É—Å –æ—Ç —Ä–µ–ø—É—Ç–∞—Ü–∏–∏ –º–µ–∫–∞
        reputation_bonus = workshop.reputation // 10
        
        # –†–∞–Ω–≥ –æ—Ä–∫–æ–≤ –≤–ª–∏—è–µ—Ç —Å–∏–ª—å–Ω–µ–µ
        rank_bonus = sum(
            self._rank_multiplier(ork.rank) 
            for ork in nearby_orks
        )
        
        # –ö–∞—á–µ—Å—Ç–≤–æ –æ—Ä—É–∂–∏—è —Ç–æ–∂–µ –≤–∞–∂–Ω–æ
        weapon_quality_bonus = self._weapon_quality_bonus(weapon)
        
        total = base + reputation_bonus + rank_bonus + weapon_quality_bonus
        
        return min(total, 100)  # –ú–∞–∫—Å–∏–º—É–º 100
    
    def _rank_multiplier(self, rank: OrkRank) -> int:
        return {
            OrkRank.GROT: 0,      # –ì—Ä–æ—Ç—ã –Ω–µ —Å—á–∏—Ç–∞—é—Ç—Å—è
            OrkRank.BOY: 1,       # –û–±—ã—á–Ω—ã–µ –æ—Ä–∫–∏
            OrkRank.NOB: 3,       # –ù–æ–±–∑—ã –¥–∞—é—Ç –±–æ–ª—å—à–µ –≤–µ—Ä—ã
            OrkRank.BOSS: 5,      # –ë–æ—Å—Å—ã –µ—â—ë –±–æ–ª—å—à–µ
            OrkRank.WARBOSS: 10   # –í–∞—Ä–±–æ—Å—Å = –º–µ–≥–∞ –±–æ–Ω—É—Å
        }[rank]
    
    def _weapon_quality_bonus(self, weapon: Weapon) -> int:
        if weapon.condition == Condition.NEW:
            return 5
        elif weapon.condition == Condition.USED:
            return 2
        return 0

class MekSkillProgressionService:
    """Domain Service: –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–∞–≤—ã–∫–æ–≤ –º–µ–∫–∞"""
    
    def check_level_up(
        self,
        workshop: MekWorkshop,
        weapons_built: int,
        explosions: int
    ) -> Optional[MekSkill]:
        """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø–æ–≤—ã—Å–∏–ª—Å—è –ª–∏ —É—Ä–æ–≤–µ–Ω—å –º–µ–∫–∞"""
        
        success_rate = 1 - (explosions / max(weapons_built, 1))
        current_skill = workshop.mek_skill
        
        # –ü—Ä–∞–≤–∏–ª–∞ –ø–æ–≤—ã—à–µ–Ω–∏—è
        if current_skill == MekSkill.GROT and weapons_built >= 10 and success_rate > 0.7:
            return MekSkill.NORMAL
        
        if current_skill == MekSkill.NORMAL and weapons_built >= 50 and success_rate > 0.8:
            return MekSkill.BIG_MEK
        
        return None
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ Aggregate:**

```python
class MekWorkshop(AggregateRoot):
    def __init__(self, workshop_id: WorkshopId, mek_name: str, mek_skill: MekSkill):
        # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
        self._mek_skill = mek_skill
    
    def build_weapon(
        self,
        blueprint: WeaponBlueprint,
        can_build_spec: CanBuildWeaponSpec  # –ò–Ω—ä–µ–∫—Ü–∏—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
    ) -> Weapon:
        """–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –æ—Ä—É–∂–∏–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏"""
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é
        if not can_build_spec.is_satisfied_by(self):
            reason = can_build_spec.why_not_satisfied(self)
            raise CannotBuildWeaponError(reason)
        
        # ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è
```

#### –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ:

‚úÖ **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª** ‚Äî —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫–æ–º–±–∏–Ω–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ AND/OR  
‚úÖ **–Ø–≤–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞** ‚Äî `RedVehicleGoFasterSpec` –≤–º–µ—Å—Ç–æ `if color == 'red'`  
‚úÖ **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª** ‚Äî —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç–µ—Å—Ç–∏—Ä—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ  
‚úÖ **Domain Services** ‚Äî –¥–ª—è –ª–æ–≥–∏–∫–∏ –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ aggregates

---

### Stage 3: CQRS ‚Äî Command Query Responsibility Segregation

**–¶–µ–ª—å:** –†–∞–∑–¥–µ–ª–∏—Ç—å –º–æ–¥–µ–ª—å –∑–∞–ø–∏—Å–∏ –∏ –º–æ–¥–µ–ª—å —á—Ç–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### –ù–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:

15. **–î–∞—à–±–æ—Ä–¥ –º–∞—Å—Ç–µ—Ä—Å–∫–æ–π** ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: —Å–æ–∑–¥–∞–Ω–Ω–æ–µ –æ—Ä—É–∂–∏–µ, –≤–∑—Ä—ã–≤—ã, success rate
16. **–¢–æ–ø –æ—Ä—É–∂–∏—è –ø–æ –¥–∞–∫–∫–µ** ‚Äî —Ä–µ–π—Ç–∏–Ω–≥ —Å–∞–º—ã—Ö –º–æ—â–Ω—ã—Ö —Å—Ç—Ä–µ–ª—è–ª
17. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –ª—É—Ç–∞** ‚Äî –∫–∞–∫–æ–π –ª—É—Ç —á–∞—â–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
18. **–ò—Å—Ç–æ—Ä–∏—è —Å–æ–±—ã—Ç–∏–π** ‚Äî audit trail –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –≤ –º–∞—Å—Ç–µ—Ä—Å–∫–æ–π
19. **Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** ‚Äî WebSocket –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

#### –ü—Ä–æ–±–ª–µ–º–∞:

–¢–µ–∫—É—â–∞—è –º–æ–¥–µ–ª—å (PostgreSQL —Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π) –ø–ª–æ—Ö–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:
- –°–ª–æ–∂–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (JOIN –ø–æ 5 —Ç–∞–±–ª–∏—Ü–∞–º)
- Real-time –¥–∞—à–±–æ—Ä–¥–æ–≤ (–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ SELECT)
- –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö (–Ω—É–∂–µ–Ω audit trail)

#### –†–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ CQRS:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ               WRITE MODEL (Commands)            ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  MekWorkshop Aggregate (PostgreSQL)       ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - –ó–∞—â–∏—Ç–∞ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - –ò—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã                        ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                      ‚îÇ                          ‚îÇ
‚îÇ                      ‚îÇ Domain Events            ‚îÇ
‚îÇ                      ‚Üì                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚Üì              ‚Üì              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ READ MODEL  ‚îÇ ‚îÇ READ MODEL   ‚îÇ ‚îÇ EVENT STORE ‚îÇ
‚îÇ (MongoDB)   ‚îÇ ‚îÇ (Redis Cache)‚îÇ ‚îÇ (Append-only‚îÇ
‚îÇ             ‚îÇ ‚îÇ              ‚îÇ ‚îÇ  log)       ‚îÇ
‚îÇ - Stats     ‚îÇ ‚îÇ - Real-time  ‚îÇ ‚îÇ             ‚îÇ
‚îÇ - Rankings  ‚îÇ ‚îÇ - Current    ‚îÇ ‚îÇ - Audit     ‚îÇ
‚îÇ - Analytics ‚îÇ ‚îÇ   state      ‚îÇ ‚îÇ - Replay    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:

**Commands (Write):**

```python
@dataclass
class BuildWeaponCommand:
    """–ö–æ–º–∞–Ω–¥–∞: –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –æ—Ä—É–∂–∏–µ"""
    workshop_id: WorkshopId
    blueprint: WeaponBlueprint
    parts_types: List[ScrapType]

class BuildWeaponCommandHandler:
    def __init__(
        self,
        workshop_repo: WorkshopRepository,
        event_bus: EventBus
    ):
        self._repo = workshop_repo
        self._event_bus = event_bus
    
    def handle(self, command: BuildWeaponCommand) -> WeaponId:
        # 1. –ó–∞–≥—Ä—É–∑–∏—Ç—å aggregate
        workshop = self._repo.get(command.workshop_id)
        
        # 2. –í—ã–ø–æ–ª–Ω–∏—Ç—å domain –ª–æ–≥–∏–∫—É
        weapon = workshop.build_weapon(
            command.blueprint,
            command.parts_types
        )
        
        # 3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å aggregate
        self._repo.save(workshop)
        
        # 4. –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ!)
        for event in workshop.domain_events:
            self._event_bus.publish(event)
        
        return weapon.id
```

**Queries (Read):**

```python
@dataclass
class GetWorkshopStatsQuery:
    """–ó–∞–ø—Ä–æ—Å: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞—Å—Ç–µ—Ä—Å–∫–æ–π"""
    workshop_id: WorkshopId

class GetWorkshopStatsQueryHandler:
    def __init__(self, mongo_client: MongoClient):
        self._db = mongo_client['read_models']
    
    def handle(self, query: GetWorkshopStatsQuery) -> WorkshopStats:
        # –ß–∏—Ç–∞–µ–º –∏–∑ –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π MongoDB
        stats_doc = self._db.workshop_stats.find_one({
            'workshop_id': str(query.workshop_id)
        })
        
        return WorkshopStats(
            total_weapons=stats_doc['total_weapons'],
            total_explosions=stats_doc['total_explosions'],
            success_rate=stats_doc['success_rate'],
            top_weapons=stats_doc['top_weapons'],
            most_used_scrap=stats_doc['most_used_scrap']
        )

@dataclass
class GetDakkaLeaderboardQuery:
    """–ó–∞–ø—Ä–æ—Å: —Ç–æ–ø –æ—Ä—É–∂–∏—è –ø–æ –¥–∞–∫–∫–µ"""
    limit: int = 10

class GetDakkaLeaderboardQueryHandler:
    def __init__(self, mongo_client: MongoClient):
        self._db = mongo_client['read_models']
    
    def handle(self, query: GetDakkaLeaderboardQuery) -> List[WeaponRanking]:
        # –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å –∏–∑ –ø—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–Ω–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏
        results = self._db.dakka_leaderboard.find().sort('dakka', -1).limit(query.limit)
        
        return [
            WeaponRanking(
                weapon_id=doc['weapon_id'],
                name=doc['name'],
                dakka=doc['dakka'],
                mek_name=doc['mek_name']
            )
            for doc in results
        ]
```

**Event Handlers (–ø—Ä–æ–µ–∫—Ü–∏–∏ –≤ Read Model):**

```python
class WeaponBuiltEventHandler:
    """–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ—Ä—É–∂–∏—è"""
    
    def __init__(self, mongo_client: MongoClient):
        self._db = mongo_client['read_models']
    
    async def handle(self, event: WeaponBuiltEvent):
        # –û–±–Ω–æ–≤–∏—Ç—å —Å—á—ë—Ç—á–∏–∫
        self._db.workshop_stats.update_one(
            {'workshop_id': str(event.workshop_id)},
            {
                '$inc': {'total_weapons': 1},
                '$set': {'last_updated': datetime.now()}
            },
            upsert=True
        )
        
        # –î–æ–±–∞–≤–∏—Ç—å –≤ leaderboard
        weapon_details = await self._get_weapon_details(event.weapon_id)
        self._db.dakka_leaderboard.insert_one({
            'weapon_id': str(event.weapon_id),
            'name': weapon_details.name,
            'dakka': weapon_details.dakka,
            'mek_name': weapon_details.mek_name,
            'created_at': event.occurred_at
        })

class WeaponExplodedEventHandler:
    """–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏ –≤–∑—Ä—ã–≤–µ"""
    
    async def handle(self, event: WeaponExplodedEvent):
        # –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –≤–∑—Ä—ã–≤–æ–≤
        result = self._db.workshop_stats.find_one_and_update(
            {'workshop_id': str(event.workshop_id)},
            {'$inc': {'total_explosions': 1}},
            return_document=ReturnDocument.AFTER
        )
        
        # –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å success rate
        success_rate = 1 - (result['total_explosions'] / result['total_weapons'])
        self._db.workshop_stats.update_one(
            {'workshop_id': str(event.workshop_id)},
            {'$set': {'success_rate': success_rate}}
        )
        
        # –£–¥–∞–ª–∏—Ç—å –∏–∑ leaderboard
        self._db.dakka_leaderboard.delete_one({
            'weapon_id': str(event.weapon_id)
        })
```

**Event Store (audit trail):**

```python
class EventStore:
    """–•—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π –¥–ª—è audit –∏ replay"""
    
    def append(self, event: DomainEvent) -> None:
        self._db.events.insert_one({
            'event_id': str(uuid.uuid4()),
            'event_type': event.__class__.__name__,
            'aggregate_id': str(event.aggregate_id),
            'payload': event.to_dict(),
            'occurred_at': event.occurred_at,
            'version': event.version
        })
    
    def get_events(
        self,
        aggregate_id: WorkshopId,
        from_version: int = 0
    ) -> List[DomainEvent]:
        """–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è aggregate"""
        docs = self._db.events.find({
            'aggregate_id': str(aggregate_id),
            'version': {'$gte': from_version}
        }).sort('version', 1)
        
        return [self._deserialize(doc) for doc in docs]
    
    def replay_all(self) -> None:
        """–ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å Read Models –∏–∑ —Å–æ–±—ã—Ç–∏–π"""
        # –ü–æ–ª–µ–∑–Ω–æ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–π –ø—Ä–æ–µ–∫—Ü–∏–∏
        events = self._db.events.find().sort('occurred_at', 1)
        
        for event_doc in events:
            event = self._deserialize(event_doc)
            self._event_bus.publish(event)
```

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ CQRS:

‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** ‚Äî read model –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –ø–æ–¥ –∑–∞–ø—Ä–æ—Å—ã  
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** ‚Äî read –∏ write –º–∞—Å—à—Ç–∞–±–∏—Ä—É—é—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ  
‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å** ‚Äî –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –ø—Ä–æ–µ–∫—Ü–∏—é –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è write model  
‚úÖ **Audit trail** ‚Äî –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —á–µ—Ä–µ–∑ Event Store  
‚úÖ **Eventual consistency** ‚Äî read model –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ

---

### Stage 4: Saga Pattern ‚Äî –°–ª–æ–∂–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã

**–¶–µ–ª—å:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–ª–æ–∂–Ω–æ–π —Ç–µ—Ö–Ω–∏–∫–∏

#### –ù–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:

20. **–ü–æ—Å—Ç—Ä–æ–∏—Ç—å Wartrukk** (–≥—Ä—É–∑–æ–≤–∏–∫) ‚Äî –º–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å:
    - –°–æ–±—Ä–∞—Ç—å —à–∞—Å—Å–∏ –∏–∑ –º–µ—Ç–∞–ª–ª–æ–ª–æ–º–∞
    - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–≤–∏–≥–∞—Ç–µ–ª—å (–ª—É—Ç–Ω—É—Ç—ã–π –∏–º–ø–µ—Ä—Å–∫–∏–π –∏–ª–∏ –æ—Ä–æ—á–∏–π)
    - –î–æ–±–∞–≤–∏—Ç—å –±—Ä–æ–Ω—é
    - –ü–æ–∫—Ä–∞—Å–∏—Ç—å –≤ –∫—Ä–∞—Å–Ω—ã–π (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
    - –¢–µ—Å—Ç-–¥—Ä–∞–π–≤ (–º–æ–∂–µ—Ç –≤–∑–æ—Ä–≤–∞—Ç—å—Å—è)
    
21. **–ü–æ—Å—Ç—Ä–æ–∏—Ç—å Deff Dread** (–±–æ–µ–≤–æ–π –¥—Ä–æ–∏–¥) ‚Äî –µ—â—ë —Å–ª–æ–∂–Ω–µ–µ:
    - –ù–∞–π—Ç–∏ –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –æ—Ä–∫–∞-–ø–∏–ª–æ—Ç–∞ (–¥–æ–±—Ä–æ–≤–æ–ª—å—Ü–∞)
    - –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—Ä–∫–∞—Å
    - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—Ä—É–∂–µ–π–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã (2-4 –æ—Ä—É–¥–∏—è)
    - –ü–æ–¥–∫–ª—é—á–∏—Ç—å —Å–∏—Å—Ç–µ–º—ã –∂–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è
    - –¢–µ—Å—Ç –±–æ—è (–º–æ–∂–µ—Ç —É–±–∏—Ç—å –ø–∏–ª–æ—Ç–∞)
    
22. **–û—Ç–∫–∞—Ç –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ** ‚Äî –≤–µ—Ä–Ω—É—Ç—å —É—Ü–µ–ª–µ–≤—à–∏–µ –¥–µ—Ç–∞–ª–∏ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å

#### –ü—Ä–æ–±–ª–µ–º–∞:

–≠—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å—ã:
- –ó–∞–Ω–∏–º–∞—é—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç—Ç–∞–ø–æ–≤
- –ú–æ–≥—É—Ç –ø—Ä–æ–≤–∞–ª–∏—Ç—å—Å—è –Ω–∞ –ª—é–±–æ–º —ç—Ç–∞–ø–µ
- –¢—Ä–µ–±—É—é—Ç –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É—é—â–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø—Ä–∏ –æ—Ç–∫–∞—Ç–µ
- –ó–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ aggregates (Workshop, Vehicle, Pilot)

#### –†–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Saga:

```python
class BuildWartrukSaga:
    """Saga: –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä—É–∑–æ–≤–∏–∫
    
    –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–∫–∞—Ç–∞
    """
    
    def __init__(
        self,
        command_bus: CommandBus,
        event_bus: EventBus,
        saga_repo: SagaRepository
    ):
        self._commands = command_bus
        self._events = event_bus
        self._repo = saga_repo
    
    async def execute(self, cmd: BuildWartrukCommand) -> WartrukId:
        """–í—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∞–≥—É"""
        
        saga_id = SagaId.generate()
        saga_state = WartrukBuildState()
        
        try:
            # –®–∞–≥ 1: –°–æ–±—Ä–∞—Ç—å —à–∞—Å—Å–∏
            chassis_result = await self._commands.send(
                BuildChassisCommand(
                    workshop_id=cmd.workshop_id,
                    required_parts=[ScrapType.METAL, ScrapType.WHEELS]
                )
            )
            saga_state.chassis_id = chassis_result.chassis_id
            saga_state.mark_step_complete('chassis')
            await self._repo.save(saga_id, saga_state)
            
            # –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–≤–∏–≥–∞—Ç–µ–ª—å
            engine_result = await self._commands.send(
                InstallEngineCommand(
                    chassis_id=saga_state.chassis_id,
                    engine_type=cmd.engine_type
                )
            )
            saga_state.engine_installed = True
            saga_state.mark_step_complete('engine')
            await self._repo.save(saga_id, saga_state)
            
            # –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å –±—Ä–æ–Ω—é
            await self._commands.send(
                AddArmorCommand(
                    vehicle_id=saga_state.chassis_id,
                    armor_parts=cmd.armor_parts
                )
            )
            saga_state.mark_step_complete('armor')
            await self._repo.save(saga_id, saga_state)
            
            # –®–∞–≥ 4: –ü–æ–∫—Ä–∞—Å–∏—Ç—å –≤ –∫—Ä–∞—Å–Ω—ã–π (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
            await self._commands.send(
                PaintVehicleCommand(
                    vehicle_id=saga_state.chassis_id,
                    color=Color.RED
                )
            )
            saga_state.painted_red = True
            saga_state.mark_step_complete('paint')
            await self._repo.save(saga_id, saga_state)
            
            # –®–∞–≥ 5: –¢–µ—Å—Ç-–¥—Ä–∞–π–≤
            test_result = await self._commands.send(
                TestDriveCommand(
                    vehicle_id=saga_state.chassis_id,
                    driver_id=cmd.driver_id
                )
            )
            
            if test_result.outcome == TestOutcome.EXPLODED:
                # –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è: –≥—Ä—É–∑–æ–≤–∏–∫ –≤–∑–æ—Ä–≤–∞–ª—Å—è
                await self._compensate_explosion(saga_state)
                raise VehicleExplodedDuringTestError()
            
            elif test_result.outcome == TestOutcome.CATASTROPHIC_FAILURE:
                # –ü–æ–ª–Ω–∞—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è: –æ—Ç–∫–∞—Ç–∏—Ç—å –≤—Å—ë
                await self._compensate_all(saga_state)
                raise BuildFailedError()
            
            # –£—Å–ø–µ—Ö!
            saga_state.mark_complete()
            await self._repo.save(saga_id, saga_state)
            
            await self._events.publish(
                WartrukBuiltEvent(
                    wartruk_id=saga_state.chassis_id,
                    workshop_id=cmd.workshop_id
                )
            )
            
            return saga_state.chassis_id
            
        except Exception as e:
            # –û—Ç–∫–∞—Ç –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ
            await self._compensate_all(saga_state)
            saga_state.mark_failed(str(e))
            await self._repo.save(saga_id, saga_state)
            raise
    
    async def _compensate_explosion(self, state: WartrukBuildState):
        """–ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –ø—Ä–∏ –≤–∑—Ä—ã–≤–µ: –≤–µ—Ä–Ω—É—Ç—å —É—Ü–µ–ª–µ–≤—à–∏–µ –¥–µ—Ç–∞–ª–∏"""
        
        # –î–≤–∏–≥–∞—Ç–µ–ª—å –æ–±—ã—á–Ω–æ –≤—ã–∂–∏–≤–∞–µ—Ç
        if state.engine_installed:
            await self._commands.send(
                RecoverEngineCommand(
                    vehicle_id=state.chassis_id,
                    condition=Condition.DAMAGED
                )
            )
        
        # –ë—Ä–æ–Ω—è —á–∞—Å—Ç–∏—á–Ω–æ —É—Ü–µ–ª–µ–ª–∞
        if state.steps_completed['armor']:
            await self._commands.send(
                RecoverArmorPartsCommand(
                    vehicle_id=state.chassis_id,
                    recovery_rate=0.5  # 50% –¥–µ—Ç–∞–ª–µ–π
                )
            )
    
    async def _compensate_all(self, state: WartrukBuildState):
        """–ü–æ–ª–Ω—ã–π –æ—Ç–∫–∞—Ç: –≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ –¥–µ—Ç–∞–ª–∏"""
        
        # –û—Ç–∫–∞—Ç –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
        if state.steps_completed['paint']:
            # –ö—Ä–∞—Å–∫—É –Ω–µ –≤–µ—Ä–Ω—ë—à—å, –Ω–æ –º–æ–∂–Ω–æ —Å–ø–∏—Å–∞—Ç—å
            pass
        
        if state.steps_completed['armor']:
            await self._commands.send(
                RemoveArmorCommand(vehicle_id=state.chassis_id)
            )
        
        if state.steps_completed['engine']:
            await self._commands.send(
                RemoveEngineCommand(vehicle_id=state.chassis_id)
            )
        
        if state.steps_completed['chassis']:
            await self._commands.send(
                DisassembleChassisCommand(chassis_id=state.chassis_id)
            )

@dataclass
class WartrukBuildState:
    """–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∞–≥–∏"""
    chassis_id: Optional[VehicleId] = None
    engine_installed: bool = False
    painted_red: bool = False
    steps_completed: Dict[str, bool] = field(default_factory=lambda: {
        'chassis': False,
        'engine': False,
        'armor': False,
        'paint': False,
        'test': False
    })
    
    def mark_step_complete(self, step: str):
        self.steps_completed[step] = True
    
    def mark_complete(self):
        self.completed = True
    
    def mark_failed(self, reason: str):
        self.failed = True
        self.failure_reason = reason
```

**Saga –¥–ª—è –µ—â—ë –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞:**

```python
class BuildDeffDreadSaga:
    """–ü–æ—Å—Ç—Ä–æ–∏—Ç—å Deff Dread - —Å–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å"""
    
    async def execute(self, cmd: BuildDeffDreadCommand):
        saga_id = SagaId.generate()
        state = DeffDreadBuildState()
        
        try:
            # –®–∞–≥ 1: –ù–∞–π—Ç–∏ –æ—Ä–∫–∞-–¥–æ–±—Ä–æ–≤–æ–ª—å—Ü–∞ (–∏–ª–∏ –Ω–µ –æ—á–µ–Ω—å –¥–æ–±—Ä–æ–≤–æ–ª—å—Ü–∞)
            pilot_result = await self._commands.send(
                FindPilotCommand(
                    min_rank=OrkRank.BOY,
                    willing_to_die=True  # –í–∞–∂–Ω–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ!
                )
            )
            
            if not pilot_result.pilot_found:
                raise NoPilotAvailableError("NO ORK WANTZ TO BE A DREAD!")
            
            state.pilot_id = pilot_result.pilot_id
            
            # –®–∞–≥ 2: –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—Ä–∫–∞—Å
            frame_result = await self._commands.send(
                BuildDreadFrameCommand(
                    workshop_id=cmd.workshop_id,
                    pilot_size=pilot_result.pilot.size
                )
            )
            state.frame_id = frame_result.frame_id
            
            # –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—Ä—É–∂–µ–π–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ!)
            weapon_tasks = [
                self._commands.send(
                    InstallWeaponSystemCommand(
                        frame_id=state.frame_id,
                        weapon_type=weapon_type,
                        mount_point=mount
                    )
                )
                for mount, weapon_type in enumerate(cmd.weapon_types)
            ]
            
            weapon_results = await asyncio.gather(*weapon_tasks)
            state.weapons_installed = [r.weapon_id for r in weapon_results]
            
            # –®–∞–≥ 4: –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∂–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ
            await self._commands.send(
                InstallLifeSupportCommand(
                    frame_id=state.frame_id,
                    pilot_id=state.pilot_id
                )
            )
            
            # –®–∞–≥ 5: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–∏–ª–æ—Ç–∞ (—Ç–æ—á–∫–∞ –Ω–µ–≤–æ–∑–≤—Ä–∞—Ç–∞!)
            await self._commands.send(
                IntegratePilotCommand(
                    dread_id=state.frame_id,
                    pilot_id=state.pilot_id
                )
            )
            state.pilot_integrated = True
            
            # –®–∞–≥ 6: –¢–µ—Å—Ç –≤ –±–æ—é
            test_result = await self._commands.send(
                CombatTestCommand(
                    dread_id=state.frame_id,
                    enemy_count=10
                )
            )
            
            if test_result.pilot_survived:
                # –£—Å–ø–µ—Ö!
                await self._events.publish(
                    DeffDreadBuiltEvent(
                        dread_id=state.frame_id,
                        pilot_id=state.pilot_id
                    )
                )
                return state.frame_id
            else:
                # –ü–∏–ª–æ—Ç –ø–æ–≥–∏–±, –Ω–æ –¥—Ä–µ–¥ —É—Ü–µ–ª–µ–ª - –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –Ω–æ–≤–æ–≥–æ
                await self._events.publish(
                    PilotKilledInTestEvent(
                        dread_id=state.frame_id,
                        pilot_id=state.pilot_id
                    )
                )
                
                # Retry —Å –Ω–æ–≤—ã–º –ø–∏–ª–æ—Ç–æ–º?
                if cmd.retry_on_pilot_death:
                    return await self.execute(cmd)  # –†–µ–∫—É—Ä—Å–∏—è!
                
                raise PilotKilledError()
                
        except Exception as e:
            # –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –æ—á–µ–Ω—å –¥–æ—Ä–æ–≥–∞—è - –ø–∏–ª–æ—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å —É–∂–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω!
            if state.pilot_integrated:
                # –°–ª–∏—à–∫–æ–º –ø–æ–∑–¥–Ω–æ –¥–ª—è –æ—Ç–∫–∞—Ç–∞
                await self._events.publish(
                    DeffDreadBuildFailedAfterIntegrationEvent(...)
                )
            else:
                await self._compensate_all(state)
            
            raise
```

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Saga:

‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª–æ–∂–Ω—ã–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏** ‚Äî —è–≤–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —à–∞–≥–æ–≤  
‚úÖ **–ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö** ‚Äî –æ—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π  
‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è** ‚Äî –º–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ—Å–ª–µ —Å–±–æ—è  
‚úÖ **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** ‚Äî —à–∞–≥–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ  
‚úÖ **Retry –ª–æ–≥–∏–∫–∞** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã

---

### Stage 5: Bounded Contexts ‚Äî –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã

**–¶–µ–ª—å:** –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞–∫ —Ä–∞–∑–±–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –Ω–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ bounded contexts

#### –ù–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:

23. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å "Lootin' Department"** ‚Äî —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä–∞–±–µ–∂–∞–º–∏
24. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å "WAAAGH! HQ"** ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ä–¥–æ–π
25. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å "Battle Management"** ‚Äî —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—è–º–∏
26. **Billing –¥–ª—è –º–∞—Å—Ç–µ—Ä—Å–∫–∏—Ö** ‚Äî –æ–ø–ª–∞—Ç–∞ –∑–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ä—É–∂–∏—è (–≤ –∑—É–±–∞—Ö)

#### –ü—Ä–æ–±–ª–µ–º–∞:

–û–¥–∏–Ω –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–º:
- –ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è –Ω–µ –¥–æ–ª–∂–Ω–∞ –∑–Ω–∞—Ç—å –∫–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã —Ä–µ–π–¥—ã
- –ë–∏—Ç–≤—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –∑–Ω–∞—Ç—å –∫–∞–∫ —Å—Ç—Ä–æ–∏—Ç—Å—è –æ—Ä—É–∂–∏–µ
- –ë–∏–ª–ª–∏–Ω–≥ –∏–º–µ–µ—Ç —Å–≤–æ—é –º–æ–¥–µ–ª—å "–æ–ø–ª–∞—Ç—ã"

#### Bounded Contexts:

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë              ORK ECOSYSTEM (Context Map)             ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   MEK WORKSHOP CONTEXT         ‚îÇ ‚Üê CORE DOMAIN
‚îÇ   (–Ω–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç)      ‚îÇ
‚îÇ                                ‚îÇ
‚îÇ   - MekWorkshop (Aggregate)    ‚îÇ
‚îÇ   - Weapon (Entity)            ‚îÇ
‚îÇ   - Building weapons           ‚îÇ
‚îÇ   - WAAAGH energy calculation  ‚îÇ
‚îÇ                                ‚îÇ
‚îÇ   Ubiquitous Language:         ‚îÇ
‚îÇ   ‚Ä¢ Shoota, Dakka, Mek         ‚îÇ
‚îÇ   ‚Ä¢ Build, Loot, Fire          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ           ‚îÇ
         ‚îÇ           ‚îÇ Published Language
         ‚îÇ           ‚îÇ (Domain Events)
         ‚Üì           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   LOOTIN'    ‚îÇ  ‚îÇ   WAAAGH! HQ     ‚îÇ
‚îÇ   CONTEXT    ‚îÇ  ‚îÇ   CONTEXT        ‚îÇ
‚îÇ              ‚îÇ  ‚îÇ                  ‚îÇ
‚îÇ - Raid       ‚îÇ  ‚îÇ - Warband        ‚îÇ
‚îÇ - Target     ‚îÇ  ‚îÇ - Ork (different ‚îÇ
‚îÇ - Plunder    ‚îÇ  ‚îÇ   model!)        ‚îÇ
‚îÇ              ‚îÇ  ‚îÇ - Territory      ‚îÇ
‚îÇ Upstream ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚î§ Conformist       ‚îÇ
‚îÇ (Supplier)   ‚îÇ  ‚îÇ (Customer)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                  ‚îÇ
         ‚îÇ ACL              ‚îÇ Events
         ‚Üì                  ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      BATTLE CONTEXT              ‚îÇ
‚îÇ                                  ‚îÇ
‚îÇ  - Battle (different aggregate!) ‚îÇ
‚îÇ  - Unit                          ‚îÇ
‚îÇ  - CombatResult                  ‚îÇ
‚îÇ                                  ‚îÇ
‚îÇ  Shared Kernel with Workshop    ‚îÇ
‚îÇ  (Color enum, DakkaRating)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ Separate Ways
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      BILLING CONTEXT             ‚îÇ
‚îÇ                                  ‚îÇ
‚îÇ  - Invoice                       ‚îÇ
‚îÇ  - Payment (in teef!)            ‚îÇ
‚îÇ  - MekAccount                    ‚îÇ
‚îÇ                                  ‚îÇ
‚îÇ  Completely different model      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### Context Map –æ—Ç–Ω–æ—à–µ–Ω–∏—è:

**1. Workshop ‚Üí Lootin' (Customer/Supplier):**

```python
# LOOTIN' CONTEXT (Upstream)
class Raid:
    """–†–µ–π–¥ –¥–ª—è –¥–æ–±—ã—á–∏ –ª—É—Ç–∞ - –∏—Ö –º–æ–¥–µ–ª—å"""
    raid_id: RaidId
    target: ImperialTarget
    loot_acquired: List[ImperialEquipment]  # –ò—Ö —Ç–µ—Ä–º–∏–Ω—ã!
    
    def complete_raid(self) -> RaidCompletedEvent:
        return RaidCompletedEvent(
            raid_id=self.raid_id,
            loot=self.loot_acquired
        )

# WORKSHOP CONTEXT (Downstream) - Anti-Corruption Layer
class LootTranslationService:
    """ACL: –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –∏–∑ —Ç–µ—Ä–º–∏–Ω–æ–≤ Lootin' –≤ –Ω–∞—à–∏ —Ç–µ—Ä–º–∏–Ω—ã"""
    
    def translate_imperial_loot(
        self,
        imperial_equipment: ImperialEquipment
    ) -> Scrap:
        """–ò–º–ø–µ—Ä—Å–∫–æ–µ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ ‚Üí –æ—Ä–æ—á–∏–π –ª—É—Ç"""
        
        # –û–Ω–∏ –Ω–∞–∑—ã–≤–∞—é—Ç —ç—Ç–æ "Lasgun Mark IV"
        # –ú—ã –Ω–∞–∑—ã–≤–∞–µ–º —ç—Ç–æ "Shooty bitz"
        
        scrap_type_map = {
            "Lasgun": ScrapType.SHOOTY_BITZ,
            "Bolter": ScrapType.BIG_SHOOTY_BITZ,
            "Rhino APC": ScrapType.ENGINE,
            "Power Armor": ScrapType.ARMOR
        }
        
        return Scrap(
            source=ScrapSource.IMPERIAL,
            scrap_type=scrap_type_map.get(
                imperial_equipment.type,
                ScrapType.JUNK
            ),
            quality=self._assess_quality(imperial_equipment),
            quantity=1
        )
    
    def _assess_quality(self, equipment: ImperialEquipment) -> Quality:
        """–û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∏–º–ø–µ—Ä—Å–∫–æ–≥–æ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è"""
        if equipment.condition == "pristine":
            return Quality.SHINY
        elif equipment.condition == "damaged":
            return Quality.RUSTY
        else:
            return Quality.NORMAL

class RaidCompletedEventHandler:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –∏–∑ Lootin' –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞"""
    
    def __init__(
        self,
        translator: LootTranslationService,
        workshop_repo: WorkshopRepository
    ):
        self._translator = translator
        self._repo = workshop_repo
    
    async def handle(self, event: RaidCompletedEvent):
        """–ö–æ–≥–¥–∞ —Ä–µ–π–¥ –∑–∞–≤–µ—Ä—à—ë–Ω - –¥–æ–±–∞–≤–∏—Ç—å –ª—É—Ç –≤ –º–∞—Å—Ç–µ—Ä—Å–∫—É—é"""
        
        # –ü–æ–ª—É—á–∏—Ç—å –º–∞—Å—Ç–µ—Ä—Å–∫—É—é –æ—Ä–¥—ã
        workshop = await self._repo.get_by_warband(event.warband_id)
        
        # –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ —á–µ—Ä–µ–∑ ACL
        for imperial_item in event.loot:
            scrap = self._translator.translate_imperial_loot(imperial_item)
            workshop.loot_scrap(scrap)
        
        await self._repo.save(workshop)
```

**2. Workshop ‚Üí WAAAGH! HQ (Published Language):**

```python
# WORKSHOP –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –Ω–∞ –æ–±—â–µ–º —è–∑—ã–∫–µ
@dataclass
class WeaponBuiltEvent(DomainEvent):
    """–°–æ–±—ã—Ç–∏–µ –ø–æ–Ω—è—Ç–Ω–æ–µ –≤—Å–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º"""
    weapon_id: WeaponId
    workshop_id: WorkshopId
    weapon_type: str  # "shoota", "big_shoota"
    dakka: int
    occurred_at: datetime

# WAAAGH! HQ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è
class WaaghHQEventHandler:
    """–í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ HQ - —Å–≤–æ—è –º–æ–¥–µ–ª—å Weapon!"""
    
    async def handle(self, event: WeaponBuiltEvent):
        # –í HQ weapon - —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Å—Ç—Ä–æ–∫–∞ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ
        warband = await self._repo.get_warband_by_workshop(
            event.workshop_id
        )
        
        # –ò—Ö –º–æ–¥–µ–ª—å –Ω–∞–º–Ω–æ–≥–æ –ø—Ä–æ—â–µ
        warband.add_equipment(
            equipment_type="weapon",
            name=event.weapon_type,
            power_level=event.dakka // 10  # –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞
        )
        
        await self._repo.save(warband)
```

**3. Workshop ‚Üî Battle (Shared Kernel):**

```python
# SHARED KERNEL - –æ–±—â–∏–µ Value Objects
# shared/domain/value_objects.py

@dataclass(frozen=True)
class DakkaRating:
    """–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –æ–±–æ–∏—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö"""
    base_dakka: int
    bonus_dakka: int
    
    @property
    def total(self) -> int:
        return self.base_dakka + self.bonus_dakka

class Color(Enum):
    """–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –æ–±–æ–∏—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö"""
    RED = "red"
    BLUE = "blue"
    GREEN = "green"
    UNPAINTED = "unpainted"

# WORKSHOP CONTEXT
class Weapon(Entity):
    def __init__(self, ..., dakka: DakkaRating, color: Color):
        self._dakka = dakka  # Shared VO
        self._color = color  # Shared VO

# BATTLE CONTEXT
class BattleWeapon(Entity):
    """–°–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –¥—Ä—É–≥–æ–π entity, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ –∂–µ VO"""
    def __init__(self, ..., firepower: DakkaRating, paint: Color):
        self._firepower = firepower  # –¢–æ—Ç –∂–µ VO!
        self._paint = paint  # –¢–æ—Ç –∂–µ VO!
```

**4. Workshop ‚ä• Billing (Separate Ways):**

```python
# BILLING CONTEXT - –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞—è –º–æ–¥–µ–ª—å
class MekAccount:
    """–í –±–∏–ª–ª–∏–Ω–≥–µ –º–µ–∫ - —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Å—á—ë—Ç"""
    account_id: AccountId
    mek_name: str  # –¢–æ–ª—å–∫–æ –∏–º—è, –±–µ–∑ domain –ª–æ–≥–∏–∫–∏
    balance_in_teef: int  # –ó—É–±—ã –∫–∞–∫ –≤–∞–ª—é—Ç–∞!
    
    def charge_for_weapon(self, weapon_complexity: int):
        cost = weapon_complexity * 10
        if self.balance_in_teef < cost:
            raise InsufficientTeefError()
        
        self.balance_in_teef -= cost

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ HTTP API (Separate Ways)
class BillingClient:
    """REST –∫–ª–∏–µ–Ω—Ç –¥–ª—è –±–∏–ª–ª–∏–Ω–≥–∞"""
    
    async def charge_for_build(
        self,
        mek_name: str,
        weapon_complexity: int
    ):
        response = await self._http.post(
            "/api/billing/charge",
            json={
                "mek_name": mek_name,
                "complexity": weapon_complexity
            }
        )
        
        if response.status_code != 200:
            raise BillingError()

# –í Workshop –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–ª–∏–µ–Ω—Ç
class BuildWeaponCommandHandler:
    def __init__(
        self,
        workshop_repo: WorkshopRepository,
        billing_client: BillingClient  # –í–Ω–µ—à–Ω—è—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
    ):
        self._repo = workshop_repo
        self._billing = billing_client
    
    async def handle(self, cmd: BuildWeaponCommand):
        workshop = await self._repo.get(cmd.workshop_id)
        
        # –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É
        await self._billing.charge_for_build(
            mek_name=workshop.mek_name,
            weapon_complexity=cmd.blueprint.complexity
        )
        
        # –ü–æ—Ç–æ–º —Å—Ç—Ä–æ–∏—Ç—å
        weapon = workshop.build_weapon(cmd.blueprint)
        await self._repo.save(workshop)
```

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º:

```
da-big-mek-workshop/
‚îú‚îÄ‚îÄ shared-kernel/
‚îÇ   ‚îî‚îÄ‚îÄ domain/
‚îÇ       ‚îî‚îÄ‚îÄ value_objects/
‚îÇ           ‚îú‚îÄ‚îÄ dakka_rating.py
‚îÇ           ‚îú‚îÄ‚îÄ color.py
‚îÇ           ‚îî‚îÄ‚îÄ primitives.py
‚îÇ
‚îú‚îÄ‚îÄ contexts/
‚îÇ   ‚îú‚îÄ‚îÄ workshop/              # –ù–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ aggregates/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entities/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ value_objects/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ events/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ application/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ infrastructure/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ anti_corruption/   # ACL –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ loot_translator.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ lootin/                # –í–Ω–µ—à–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (–¥–ª—è –ø—Ä–∏–º–µ—Ä–∞)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ (–∏—Ö –∫–æ–¥)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ waaagh-hq/             # –í–Ω–µ—à–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ (–∏—Ö –∫–æ–¥)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ battle/                # Shared Kernel —Å Workshop
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ (–∏—Ö –∫–æ–¥)
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ billing/               # –û—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å
‚îÇ       ‚îî‚îÄ‚îÄ (–∏—Ö –∫–æ–¥)
‚îÇ
‚îî‚îÄ‚îÄ integration/
    ‚îú‚îÄ‚îÄ event_bus.py           # –î–ª—è Published Language
    ‚îî‚îÄ‚îÄ http_clients/          # –î–ª—è Separate Ways
```

#### –ó–∞—á–µ–º Bounded Contexts:

‚úÖ **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å** ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã —Ä–∞–∑–≤–∏–≤–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ  
‚úÖ **–†–∞–∑–Ω—ã–µ –º–æ–¥–µ–ª–∏** ‚Äî Weapon –≤ Workshop ‚â† Weapon –≤ Battle  
‚úÖ **–£–ø—Ä–æ—â–µ–Ω–∏–µ** ‚Äî –∫–∞–∂–¥—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–µ—à–∞–µ—Ç —Å–≤–æ—é –∑–∞–¥–∞—á—É  
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –º–æ–∂–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã  
‚úÖ **–ö–æ–º–∞–Ω–¥—ã** ‚Äî —Ä–∞–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞–¥ —Ä–∞–∑–Ω—ã–º–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º–∏

---

## üìä –ò—Ç–æ–≥–æ–≤–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ: –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π vs DDD

| –ê—Å–ø–µ–∫—Ç | –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π (Stage 0) | DDD (Stage 5) |
|--------|--------------------------|---------------|
| **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞** | –†–∞–∑–º–∞–∑–∞–Ω–∞ –ø–æ services.py | –ò–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞–Ω–∞ –≤ aggregates |
| **–í–∞–ª–∏–¥–∞—Ü–∏—è** | –î—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ 5 –º–µ—Å—Ç–∞—Ö | –ó–∞—â–∏—â–µ–Ω–∞ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ |
| **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** | –¢—Ä–µ–±—É–µ—Ç –º–æ–∫–∏ –ë–î | Pure domain tests –±–µ–∑ –ë–î |
| **–ü–æ–Ω–∏–º–∞–Ω–∏–µ** | –ù—É–∂–Ω–æ —á–∏—Ç–∞—Ç—å –∫–æ–¥ | Ubiquitous Language |
| **–ò–∑–º–µ–Ω–µ–Ω–∏—è** | –ó–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç 10+ —Ñ–∞–π–ª–æ–≤ | –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–º aggregate |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | –û–¥–Ω–∞ –ë–î –¥–ª—è –≤—Å–µ–≥–æ | CQRS: write/read —Ä–∞–∑–¥–µ–ª–µ–Ω—ã |
| **–°–ª–æ–∂–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã** | –°–ø–∞–≥–µ—Ç—Ç–∏ –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö | –Ø–≤–Ω—ã–µ Sagas |
| **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** | –ú–æ–Ω–æ–ª–∏—Ç | Bounded Contexts ‚Üí –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã |
| **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** | –ü—Ä—è–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ | ACL, Published Language |
| **Audit trail** | –ù—É–∂–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é | Event Sourcing –∏–∑ –∫–æ—Ä–æ–±–∫–∏ |

---

## üéì –ß—Ç–æ –≤—ã –∏–∑—É—á–∏—Ç–µ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ

### Stage 0 ‚Üí 1: Tactical DDD
- Value Objects vs Entities
- Aggregate Roots
- Domain Events
- Rich Domain Model
- –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã

### Stage 1 ‚Üí 2: Specifications & Services
- Specification Pattern
- Domain Services
- Composable business rules
- Dependency Injection

### Stage 2 ‚Üí 3: CQRS
- Command/Query —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ
- Event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- Event Sourcing
- Eventual Consistency
- Read Models

### Stage 3 ‚Üí 4: Sagas
- Distributed transactions
- –ö–æ–º–ø–µ–Ω—Å–∏—Ä—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
- Orchestration vs Choreography
- Saga state management

### Stage 4 ‚Üí 5: Strategic DDD
- Bounded Contexts
- Context Mapping
- Anti-Corruption Layer
- Published Language
- Microservices architecture

---

## üöÄ –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/yourusername/da-big-mek-workshop.git

# –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –Ω—É–∂–Ω—ã–π —ç—Ç–∞–ø
git checkout stage-0-anemic  # –ù–∞—á–∞—Ç—å —Å –±–æ–ª–∏
git checkout stage-1-tactical # –ò–ª–∏ —Å—Ä–∞–∑—É —Å DDD
git checkout stage-5-contexts # –ò–ª–∏ —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
pytest

# –ü–æ–¥–Ω—è—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É (–¥–ª—è stage 3+)
docker-compose up -d

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
python manage.py runserver
```

---

## üìñ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- [Domain-Driven Design by Eric Evans](https://www.domainlanguage.com/ddd/)
- [Implementing Domain-Driven Design by Vaughn Vernon](https://vaughnvernon.com/)
- [Warhammer 40k Ork Lore](https://warhammer40k.fandom.com/wiki/Orks) –¥–ª—è –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è üü¢

---

**WAAAGH! Let's build some proppa' DDD!** üü¢‚öôÔ∏èüí•
